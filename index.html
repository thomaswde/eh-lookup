<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Catalog Browser</title>
    <link rel="icon" href="favicon.png" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1f2937;
        }
        ::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280;
        }
        /* Style for range slider track */
        input[type=range]::-webkit-slider-runnable-track {
            background: #374151;
            height: 4px;
            border-radius: 2px;
        }
        input[type=range]::-moz-range-track {
            background: #374151;
            height: 4px;
            border-radius: 2px;
        }
        /* Style for range slider thumb */
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            background: #3b82f6;
            cursor: pointer;
            border-radius: 50%;
            margin-top: -6px;
        }
        input[type=range]::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: #3b82f6;
            cursor: pointer;
            border-radius: 50%;
        }
        /* Basic transition for card hover */
        .product-card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2), 0 4px 6px -2px rgba(0, 0, 0, 0.1);
        }
        .modal-content {
            animation: slide-up 0.3s ease-out;
        }
        @keyframes slide-up {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200">

    <div class="flex flex-col lg:flex-row min-h-screen">
        <!-- Left Pane: Filters -->
        <aside class="w-full lg:w-80 bg-gray-800 p-6 space-y-6 lg:fixed lg:h-full lg:overflow-y-auto">
            <div class="flex items-center justify-between">
                 <h1 class="text-2xl font-bold text-white">Product Filters</h1>
                 <button id="reset-filters" class="text-sm text-blue-400 hover:text-blue-300">Reset</button>
            </div>


            <!-- Free Form Search -->
            <div>
                <label for="search" class="block text-sm font-medium text-gray-400 mb-2">Search</label>
                <input type="text" id="search" placeholder="Search by name, SKU, etc." class="w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-3 text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>

            <!-- Category Filter -->
            <div id="category-filter">
                <h3 class="text-sm font-medium text-gray-400 mb-2">Category</h3>
                <div id="category-options" class="space-y-2">
                    <!-- Checkboxes will be dynamically inserted here -->
                </div>
            </div>

            <!-- Performance Filters -->
            <div>
                 <h3 class="text-sm font-medium text-gray-400 mb-2 border-t border-gray-700 pt-4">Performance</h3>
                 <div class="space-y-4">
                    <div>
                         <label for="baseGbps" class="block text-xs font-medium text-gray-400">Min Throughput (Gbps): <span id="baseGbps-value" class="font-bold text-blue-400">0</span></label>
                         <input type="range" id="baseGbps" min="0" max="100" value="0" class="w-full h-2 rounded-lg appearance-none cursor-pointer">
                    </div>
                 </div>
            </div>

             <!-- Physical Attributes -->
            <div>
                <h3 class="text-sm font-medium text-gray-400 mb-2 border-t border-gray-700 pt-4">Attributes</h3>
                <div class="space-y-4">
                    <div>
                        <label for="powerWatts" class="block text-xs font-medium text-gray-400">Max Power (Watts): <span id="powerWatts-value" class="font-bold text-blue-400">1500</span></label>
                        <input type="range" id="powerWatts" min="0" max="1500" value="1500" step="50" class="w-full h-2 rounded-lg appearance-none cursor-pointer">
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="isPhysical" class="h-4 w-4 rounded border-gray-600 bg-gray-700 text-blue-600 focus:ring-blue-500">
                        <label for="isPhysical" class="ml-2 text-sm text-gray-300">Physical Appliance</label>
                    </div>
                </div>
            </div>

            <!-- Sale Status & Type -->
            <div>
                <h3 class="text-sm font-medium text-gray-400 mb-2 border-t border-gray-700 pt-4">Status & Type</h3>
                <div id="saleStatus-filter" class="space-y-2">
                     <!-- Sale status radios will be inserted here -->
                </div>
                <div class="flex items-center mt-2">
                    <input type="checkbox" id="rx360Only" class="h-4 w-4 rounded border-gray-600 bg-gray-700 text-blue-600 focus:ring-blue-500">
                    <label for="rx360Only" class="ml-2 text-sm text-gray-300">Rx360 Only</label>
                </div>
                 <div class="flex items-center mt-2">
                    <input type="checkbox" id="enterpriseOnly" class="h-4 w-4 rounded border-gray-600 bg-gray-700 text-blue-600 focus:ring-blue-500">
                    <label for="enterpriseOnly" class="ml-2 text-sm text-gray-300">Enterprise Only</label>
                </div>
            </div>

            <!-- Data Source -->
            <div>
                <h3 class="text-sm font-medium text-gray-400 mb-2 border-t border-gray-700 pt-4">Data Source</h3>
                <div class="space-y-2">
                    <div>
                        <label for="filename-input" class="block text-xs font-medium text-gray-400">Filename</label>
                        <div class="flex items-center space-x-2 mt-1">
                             <input type="text" id="filename-input" value="product.catalog.json" class="flex-grow bg-gray-700 border border-gray-600 rounded-md py-2 px-3 text-white focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm">
                             <button id="load-data-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-3 rounded-md text-sm">Load</button>
                        </div>
                    </div>
                    <p id="data-source-status" class="text-xs text-gray-500">Not loaded yet.</p>
                </div>
            </div>

        </aside>

        <!-- Right Pane: Results -->
        <main class="w-full lg:ml-80 p-6 lg:p-10">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-3xl font-bold text-white">Products</h2>
                <p id="product-count" class="text-gray-400">Loading products...</p>
            </div>
            <div id="results" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6">
                <!-- Product cards will be dynamically inserted here -->
            </div>
             <div id="no-results" class="hidden text-center py-20">
                <p class="text-gray-400 text-lg">No products match your criteria.</p>
            </div>
        </main>
    </div>

    <!-- Modal for Product Details -->
    <div id="modal" class="hidden fixed inset-0 bg-black bg-opacity-70 z-50 flex items-center justify-center p-4">
        <div id="modal-content" class="modal-content bg-gray-800 rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto relative">
            <!-- Modal Header -->
            <div class="sticky top-0 bg-gray-800 px-6 py-4 border-b border-gray-700 flex justify-between items-center z-10">
                <h2 id="modal-title" class="text-2xl font-bold text-white"></h2>
                <button id="modal-close" class="text-gray-400 hover:text-white">&times;</button>
            </div>
            <!-- Modal Body -->
            <div id="modal-body" class="p-6">
                <!-- Details will be injected here -->
            </div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const resultsContainer = document.getElementById('results');
            const noResultsMessage = document.getElementById('no-results');
            const searchInput = document.getElementById('search');
            const categoryOptionsContainer = document.getElementById('category-options');
            const saleStatusContainer = document.getElementById('saleStatus-filter');
            const productCountElement = document.getElementById('product-count');
            const modal = document.getElementById('modal');
            const modalContent = document.getElementById('modal-content');
            const modalCloseButton = document.getElementById('modal-close');
            const modalTitle = document.getElementById('modal-title');
            const modalBody = document.getElementById('modal-body');
            const resetFiltersButton = document.getElementById('reset-filters');
            
            // Data source elements
            const filenameInput = document.getElementById('filename-input');
            const loadDataBtn = document.getElementById('load-data-btn');
            const dataSourceStatus = document.getElementById('data-source-status');

            // Filter elements
            const baseGbpsSlider = document.getElementById('baseGbps');
            const baseGbpsValue = document.getElementById('baseGbps-value');
            const powerWattsSlider = document.getElementById('powerWatts');
            const powerWattsValue = document.getElementById('powerWatts-value');
            const isPhysicalCheckbox = document.getElementById('isPhysical');
            const rx360OnlyCheckbox = document.getElementById('rx360Only');
            const enterpriseOnlyCheckbox = document.getElementById('enterpriseOnly');

            let products = [];
            let chartInstances = {}; // To keep track of created charts

            // Fetch product data
            async function loadProducts() {
                const filename = filenameInput.value.trim();
                if (!filename) {
                    dataSourceStatus.textContent = 'Please enter a filename.';
                    dataSourceStatus.classList.remove('text-gray-500', 'text-green-400');
                    dataSourceStatus.classList.add('text-red-400');
                    return;
                }

                // Always use a relative path prefix
                const filePath = filename.startsWith('./') ? filename : `./${filename}`;

                try {
                    const response = await fetch(filePath);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status} - ${response.statusText}`);
                    }
                    const data = await response.json();
                    products = data.products;
                    initializeFilters();
                    renderProducts();

                    dataSourceStatus.textContent = `Loaded from: ${filename}`;
                    dataSourceStatus.classList.remove('text-red-400', 'text-gray-500');
                    dataSourceStatus.classList.add('text-green-400');
                } catch (error) {
                    console.error(`Could not load product data from ${filename}:`, error);
                    let errorMessage = `Failed to load: "${filename}".`;
                    if (error instanceof SyntaxError) {
                         errorMessage += `<br>This is likely due to an invalid JSON format in the file. Please validate the JSON.`;
                    } else {
                         errorMessage += `<br>Ensure the file exists and the repository is public.`;
                    }
                    resultsContainer.innerHTML = `<p class="text-red-400">${errorMessage}</p>`;
                    productCountElement.textContent = 'Error';
                    
                    dataSourceStatus.textContent = `Error loading ${filename}.`;
                    dataSourceStatus.classList.remove('text-green-400', 'text-gray-500');
                    dataSourceStatus.classList.add('text-red-400');
                }
            }

            // Capitalize and format strings
            function formatString(str) {
                if (!str) return 'N/A';
                return str.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
            }

            // Initialize filters based on product data
            function initializeFilters() {
                const categories = [...new Set(products.map(p => p.category))];
                categoryOptionsContainer.innerHTML = categories.map(cat => `
                    <div class="flex items-center">
                        <input type="checkbox" id="cat-${cat}" name="category" value="${cat}" class="h-4 w-4 rounded border-gray-600 bg-gray-700 text-blue-600 focus:ring-blue-500">
                        <label for="cat-${cat}" class="ml-2 text-sm text-gray-300">${formatString(cat)}</label>
                    </div>
                `).join('');

                const saleStatuses = [...new Set(products.map(p => p.saleStatus))];
                saleStatusContainer.innerHTML = `
                    <h3 class="text-sm font-medium text-gray-400 mb-2">Sale Status</h3>
                     <div class="flex items-center">
                        <input type="radio" id="status-all" name="saleStatus" value="all" class="h-4 w-4 border-gray-600 bg-gray-700 text-blue-600 focus:ring-blue-500" checked>
                        <label for="status-all" class="ml-2 text-sm text-gray-300">All</label>
                    </div>
                    ${saleStatuses.map(status => `
                     <div class="flex items-center">
                        <input type="radio" id="status-${status}" name="saleStatus" value="${status}" class="h-4 w-4 border-gray-600 bg-gray-700 text-blue-600 focus:ring-blue-500">
                        <label for="status-${status}" class="ml-2 text-sm text-gray-300">${formatString(status)}</label>
                    </div>
                    `).join('')}
                `;

                // Set max for sliders based on data
                const maxGbps = Math.max(...products.map(p => p.baseGbps || 0));
                baseGbpsSlider.max = maxGbps;
                const maxWatts = Math.max(...products.map(p => p.powerWatts || 0));
                powerWattsSlider.max = maxWatts;
                powerWattsSlider.value = maxWatts;
                powerWattsValue.textContent = maxWatts;


                addFilterListeners();
            }


            // Filter and render products
            function renderProducts() {
                const searchTerm = searchInput.value.toLowerCase();

                const selectedCategories = Array.from(document.querySelectorAll('input[name="category"]:checked')).map(cb => cb.value);
                const selectedSaleStatus = document.querySelector('input[name="saleStatus"]:checked').value;

                const minGbps = parseInt(baseGbpsSlider.value, 10);
                const maxPower = parseInt(powerWattsSlider.value, 10);
                const isPhysical = isPhysicalCheckbox.checked;
                const rx360Only = rx360OnlyCheckbox.checked;
                const enterpriseOnly = enterpriseOnlyCheckbox.checked;

                const filteredProducts = products.filter(p => {
                    // Search filter
                    const searchMatch = searchTerm.length > 0 ?
                        JSON.stringify(p).toLowerCase().includes(searchTerm) :
                        true;

                    // Category filter
                    const categoryMatch = selectedCategories.length > 0 ?
                        selectedCategories.includes(p.category) :
                        true;

                    // Sale status filter
                    const saleStatusMatch = selectedSaleStatus !== 'all' ? p.saleStatus === selectedSaleStatus : true;

                    // Range and checkbox filters
                    const gbpsMatch = (p.baseGbps || 0) >= minGbps;
                    const powerMatch = (p.powerWatts || 0) <= maxPower;
                    const physicalMatch = isPhysical ? p.isPhysical === true : true;
                    const rx360Match = rx360Only ? p.rx360Only === true : true;
                    const enterpriseMatch = enterpriseOnly ? p.enterpriseOnly === true : true;

                    return searchMatch && categoryMatch && saleStatusMatch && gbpsMatch && powerMatch && physicalMatch && rx360Match && enterpriseMatch;
                });

                resultsContainer.innerHTML = '';
                if (filteredProducts.length === 0 && products.length > 0) {
                    noResultsMessage.classList.remove('hidden');
                } else {
                     noResultsMessage.classList.add('hidden');
                }


                filteredProducts.forEach(product => {
                    const card = document.createElement('div');
                    card.className = 'product-card bg-gray-800 rounded-lg shadow-lg p-5 flex flex-col cursor-pointer border border-gray-700';
                    card.dataset.productName = product.name;

                    const statusColor = product.saleStatus === 'active' ? 'bg-green-500' : 'bg-red-500';

                    const supportedModulesText = (product.supportedModules && product.supportedModules.length > 0)
                        ? `Supported Modules: ${product.supportedModules.join(', ')}`
                        : 'Supported Modules: N/A';

                    card.innerHTML = `
                        <div class="flex-grow">
                             <div class="flex justify-between items-start">
                                <h3 class="text-xl font-bold text-white">${product.name}</h3>
                                <span class="text-xs font-semibold px-2 py-1 ${statusColor} rounded-full">${formatString(product.saleStatus)}</span>
                            </div>
                            <p class="text-sm text-gray-400 mb-4">${formatString(product.category)}</p>

                            <div class="grid grid-cols-2 gap-x-4 gap-y-2 text-sm mb-4">
                                <div class="text-gray-400">Throughput: <span class="font-semibold text-gray-200">${product.baseGbps ?? 'N/A'} Gbps</span></div>
                                <div class="text-gray-400">Form Factor: <span class="font-semibold text-gray-200">${product.isPhysical ? 'Physical' : 'Virtual'}</span></div>
                                ${product.powerWatts ? `<div class="text-gray-400">Power: <span class="font-semibold text-gray-200">${product.powerWatts}W</span></div>` : ''}
                                ${product.rackUnits ? `<div class="text-gray-400">Rack Units: <span class="font-semibold text-gray-200">${product.rackUnits}U</span></div>` : ''}
                            </div>
                        </div>
                        <div class="border-t border-gray-700 pt-3 text-xs text-gray-500">
                           ${supportedModulesText}
                        </div>
                    `;
                    resultsContainer.appendChild(card);
                });

                productCountElement.textContent = `${filteredProducts.length} of ${products.length} products shown`;
            }

            // Function to create a detail item for the modal
            function createDetailItem(label, value) {
                if (value === undefined || value === null || (Array.isArray(value) && value.length === 0)) return '';
                let displayValue = '';
                 if (typeof value === 'boolean') {
                    displayValue = value ? `<span class="px-2 py-1 text-xs rounded-full bg-blue-600 text-white">Yes</span>` : `<span class="px-2 py-1 text-xs rounded-full bg-gray-600 text-gray-200">No</span>`;
                } else if (Array.isArray(value)) {
                    displayValue = value.map(item => `<span class="inline-block bg-gray-600 rounded-full px-3 py-1 text-sm font-semibold text-gray-200 mr-2 mb-2">${formatString(item)}</span>`).join('');
                } else {
                    displayValue = `<p class="text-gray-200">${value}</p>`;
                }

                return `
                    <div class="py-3 sm:grid sm:grid-cols-3 sm:gap-4">
                        <dt class="text-sm font-medium text-gray-400">${label}</dt>
                        <dd class="mt-1 text-sm sm:mt-0 sm:col-span-2">${displayValue}</dd>
                    </div>
                `;
            }

            // Show modal with product details
            function showModal(productName) {
                const product = products.find(p => p.name === productName);
                if (!product) return;

                // Destroy previous charts
                Object.values(chartInstances).forEach(chart => chart.destroy());
                chartInstances = {};

                modalTitle.textContent = product.name;

                let detailsHtml = '<dl class="divide-y divide-gray-700">';
                detailsHtml += createDetailItem('Category', formatString(product.category));
                detailsHtml += createDetailItem('Generation', product.generation);
                detailsHtml += createDetailItem('Form Factor', product.isPhysical ? 'Physical' : 'Virtual');
                detailsHtml += createDetailItem('Sale Status', formatString(product.saleStatus));
                detailsHtml += createDetailItem('Base Throughput', `${product.baseGbps ?? 0} Gbps`);
                detailsHtml += createDetailItem('IDS Throughput', `${product.idsGbps ?? 0} Gbps`);
                if (product.powerWatts) detailsHtml += createDetailItem('Power', `${product.powerWatts} Watts`);
                if (product.rackUnits) detailsHtml += createDetailItem('Rack Units', `${product.rackUnits}U`);
                detailsHtml += createDetailItem('Supported Modules', product.supportedModules);
                if (product.cloudSupport) detailsHtml += createDetailItem('Cloud Support', product.cloudSupport);
                if (product.virtualSupport) detailsHtml += createDetailItem('Virtual Support', product.virtualSupport);
                detailsHtml += createDetailItem('Enterprise SKU', product.skus?.enterprise || 'N/A');
                detailsHtml += createDetailItem('Rx360 SKU', product.skus?.rx360 || 'N/A');
                detailsHtml += '</dl>';

                // Add visualizations
                let chartsHtml = '<div class="grid md:grid-cols-2 gap-6 mt-6 pt-6 border-t border-gray-700">';

                let hasPerfChart = (product.baseGbps || product.idsGbps);
                let hasAnalysisChart = (product.standardAnalysis || product.advancedAnalysis);

                if (hasPerfChart) {
                    chartsHtml += '<div><h4 class="text-lg font-semibold mb-2 text-center text-gray-300">Performance (Gbps)</h4><canvas id="perfChart"></canvas></div>';
                }
                if(hasAnalysisChart) {
                     chartsHtml += '<div><h4 class="text-lg font-semibold mb-2 text-center text-gray-300">Analysis Capacity</h4><canvas id="analysisChart"></canvas></div>';
                }
                 if (!hasPerfChart && !hasAnalysisChart) {
                    chartsHtml += '<div class="md:col-span-2 text-center text-gray-500">No visualization data available for this product.</div>';
                }

                chartsHtml += '</div>';

                modalBody.innerHTML = detailsHtml + chartsHtml;

                // Create charts after HTML is in the DOM
                 if (hasPerfChart) createPerfChart(product);
                 if (hasAnalysisChart) createAnalysisChart(product);

                modal.classList.remove('hidden');
            }

            function createChart(canvasId, label, labels, data, backgroundColors) {
                 const ctx = document.getElementById(canvasId).getContext('2d');
                 chartInstances[canvasId] = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: label,
                            data: data,
                            backgroundColor: backgroundColors,
                            borderColor: backgroundColors.map(c => c.replace('0.6', '1')),
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: { color: '#9ca3af' },
                                grid: { color: '#374151' }
                            },
                            x: {
                                ticks: { color: '#d1d5db' },
                                grid: { display: false }
                            }
                        }
                    }
                });
            }


            function createPerfChart(product) {
               createChart('perfChart', 'Gbps', ['Base', 'IDS'], [product.baseGbps || 0, product.idsGbps || 0], ['rgba(59, 130, 246, 0.6)', 'rgba(239, 68, 68, 0.6)']);
            }

            function createAnalysisChart(product) {
                createChart('analysisChart', 'Analysis Capacity', ['Standard', 'Advanced'], [product.standardAnalysis || 0, product.advancedAnalysis || 0], ['rgba(16, 185, 129, 0.6)', 'rgba(245, 158, 11, 0.6)']);
            }


            // Add event listeners for filters
            function addFilterListeners() {
                searchInput.addEventListener('input', renderProducts);
                categoryOptionsContainer.addEventListener('change', renderProducts);
                saleStatusContainer.addEventListener('change', renderProducts);

                baseGbpsSlider.addEventListener('input', () => {
                    baseGbpsValue.textContent = baseGbpsSlider.value;
                    renderProducts();
                });
                powerWattsSlider.addEventListener('input', () => {
                    powerWattsValue.textContent = powerWattsSlider.value;
                    renderProducts();
                });

                [isPhysicalCheckbox, rx360OnlyCheckbox, enterpriseOnlyCheckbox].forEach(checkbox => {
                    checkbox.addEventListener('change', renderProducts);
                });
            }

            function resetFilters() {
                searchInput.value = '';
                document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
                document.getElementById('status-all').checked = true;

                baseGbpsSlider.value = 0;
                baseGbpsValue.textContent = 0;

                const maxWatts = powerWattsSlider.max;
                powerWattsSlider.value = maxWatts;
                powerWattsValue.textContent = maxWatts;
                renderProducts();
            }

            // Event delegation for opening modal
            resultsContainer.addEventListener('click', (e) => {
                const card = e.target.closest('.product-card');
                if (card) {
                    showModal(card.dataset.productName);
                }
            });

            // Close modal events
            modalCloseButton.addEventListener('click', () => modal.classList.add('hidden'));
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.add('hidden');
                }
            });
            resetFiltersButton.addEventListener('click', resetFilters);

            loadDataBtn.addEventListener('click', loadProducts);

            // Initial load
            loadProducts();
        });
    </script>
</body>
</html>

