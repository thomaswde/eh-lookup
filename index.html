<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Catalog Browser</title>
    <link rel="icon" href="favicon.png" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #261f63; /* Sapphire */
        }
        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #2a236a; }
        ::-webkit-scrollbar-thumb { background: #4a4389; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #5c53a8; }
        
        /* Toggle Switch Styles */
        .toggle-checkbox:checked {
            right: 0;
            border-color: #00aaef; /* Cyan */
        }
        .toggle-checkbox:checked + .toggle-label {
            background-color: #00aaef; /* Cyan */
        }
        /* Basic transition for card hover */
        .product-card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2), 0 4px 6px -2px rgba(0, 0, 0, 0.1);
        }
        .modal-content {
            animation: slide-up 0.3s ease-out;
        }
        @keyframes slide-up {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
    </style>
</head>
<body class="text-gray-200">

    <div class="flex flex-col lg:flex-row min-h-screen">
        <!-- Left Pane: Filters -->
        <aside class="w-full lg:w-80 bg-[#2a236a] p-6 space-y-6 lg:fixed lg:h-full lg:overflow-y-auto">
            <!-- Logo -->
            <div>
                <img src="eh_logo.png" alt="Company Logo" class="w-full h-auto">
            </div>

            <div class="flex items-center justify-between">
                 <h1 class="text-2xl font-bold text-white">Product Filters</h1>
                 <button id="reset-filters" class="text-sm text-[#00aaef] hover:text-[#33c3ff]">Reset</button>
            </div>

            <!-- Free Form Search -->
            <div>
                <label for="search" class="block text-sm font-medium text-gray-400 mb-2">Search</label>
                <input type="text" id="search" placeholder="Search by name, SKU, etc." class="w-full bg-[#3E357E] border border-[#4a4389] rounded-md py-2 px-3 text-white focus:outline-none focus:ring-2 focus:ring-[#00aaef]">
            </div>

            <!-- Sale Status Filter -->
            <div>
                <h3 class="text-sm font-medium text-gray-400 mb-2 border-t border-[#4a4389] pt-4">Status</h3>
                <div class="flex items-center justify-between">
                    <label for="active-only-toggle" class="text-sm text-gray-300">Show Active Products Only</label>
                    <div class="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in">
                        <input type="checkbox" name="toggle" id="active-only-toggle" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer" checked/>
                        <label for="active-only-toggle" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-600 cursor-pointer"></label>
                    </div>
                </div>
            </div>

            <!-- Category Filter -->
            <div id="category-filter">
                <h3 class="text-sm font-medium text-gray-400 mb-2 border-t border-[#4a4389] pt-4">Category</h3>
                <div id="category-options" class="space-y-2">
                    <!-- Checkboxes will be dynamically inserted here -->
                </div>
            </div>

            <!-- Deployment Type Filter -->
            <div id="deployment-type-filter">
                <h3 class="text-sm font-medium text-gray-400 mb-2 border-t border-[#4a4389] pt-4">Deployment Type</h3>
                <div id="deployment-options" class="space-y-2">
                    <!-- Deployment checkboxes inserted here -->
                </div>
            </div>

            <!-- Data Source -->
            <div>
                <h3 class="text-sm font-medium text-gray-400 mb-2 border-t border-[#4a4389] pt-4">Data Source</h3>
                <div class="space-y-2">
                    <div>
                        <label for="filename-input" class="block text-xs font-medium text-gray-400">Filename</label>
                        <div class="flex items-center space-x-2 mt-1">
                             <input type="text" id="filename-input" value="product.catalog.json" class="flex-grow bg-[#3E357E] border border-[#4a4389] rounded-md py-2 px-3 text-white focus:outline-none focus:ring-2 focus:ring-[#00aaef] text-sm">
                             <button id="load-data-btn" class="bg-[#00aaef] hover:bg-[#0098d7] text-white font-bold py-2 px-3 rounded-md text-sm">Load</button>
                        </div>
                    </div>
                    <p id="data-source-status" class="text-xs text-gray-500">Not loaded yet.</p>
                </div>
            </div>
        </aside>

        <!-- Right Pane: Results -->
        <main class="w-full lg:ml-80 p-6 lg:p-10">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-3xl font-bold text-white">Products</h2>
                <p id="product-count" class="text-gray-400">Loading products...</p>
            </div>
            <div id="results" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6">
                <!-- Product cards will be dynamically inserted here -->
            </div>
             <div id="no-results" class="hidden text-center py-20">
                <p class="text-gray-400 text-lg">No products match your criteria.</p>
            </div>
        </main>
    </div>

    <!-- Modal for Product Details -->
    <div id="modal" class="hidden fixed inset-0 bg-black bg-opacity-70 z-50 flex items-center justify-center p-4">
        <div id="modal-content" class="modal-content bg-[#2a236a] rounded-lg shadow-xl w-full max-w-5xl max-h-[90vh] overflow-y-auto relative">
            <div class="sticky top-0 bg-[#2a236a] px-6 py-4 border-b border-[#4a4389] flex justify-between items-center z-10">
                <h2 id="modal-title" class="text-2xl font-bold text-white"></h2>
                <button id="modal-close" class="text-gray-400 hover:text-white text-3xl">&times;</button>
            </div>
            <div id="modal-body" class="p-6">
                <!-- Details will be injected here -->
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const resultsContainer = document.getElementById('results');
            const noResultsMessage = document.getElementById('no-results');
            const searchInput = document.getElementById('search');
            const categoryOptionsContainer = document.getElementById('category-options');
            const productCountElement = document.getElementById('product-count');
            const modal = document.getElementById('modal');
            const modalCloseButton = document.getElementById('modal-close');
            const modalTitle = document.getElementById('modal-title');
            const modalBody = document.getElementById('modal-body');
            const resetFiltersButton = document.getElementById('reset-filters');
            
            const filenameInput = document.getElementById('filename-input');
            const loadDataBtn = document.getElementById('load-data-btn');
            const dataSourceStatus = document.getElementById('data-source-status');

            // New Filter elements
            const activeOnlyToggle = document.getElementById('active-only-toggle');
            const deploymentOptionsContainer = document.getElementById('deployment-options');

            let products = [];
            let chartInstances = {}; 

            async function loadProducts() {
                const filename = filenameInput.value.trim();
                if (!filename) {
                    dataSourceStatus.textContent = 'Please enter a filename.';
                    dataSourceStatus.classList.add('text-red-400');
                    return;
                }
                const filePath = `./${filename}`;

                try {
                    const response = await fetch(filePath);
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    const data = await response.json();
                    products = data.products;
                    initializeFilters();
                    renderProducts();
                    dataSourceStatus.textContent = `Loaded from: ${filename}`;
                    dataSourceStatus.classList.remove('text-red-400', 'text-gray-500');
                    dataSourceStatus.classList.add('text-green-400');
                } catch (error) {
                    console.error(`Could not load product data from ${filename}:`, error);
                    let errorMessage = `Failed to load: "${filename}".`;
                    if (error instanceof SyntaxError) errorMessage += `<br>Invalid JSON format in file.`;
                    else errorMessage += `<br>Ensure file exists and repo is public.`;
                    resultsContainer.innerHTML = `<p class="text-red-400">${errorMessage}</p>`;
                    productCountElement.textContent = 'Error';
                    dataSourceStatus.textContent = `Error loading ${filename}.`;
                    dataSourceStatus.classList.add('text-red-400');
                }
            }

            function formatString(str) {
                if (!str) return 'N/A';
                return str.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
            }

            function initializeFilters() {
                const categories = [...new Set(products.map(p => p.category))];
                categoryOptionsContainer.innerHTML = categories.map(cat => `
                    <div class="flex items-center">
                        <input type="checkbox" id="cat-${cat}" name="category" value="${cat}" class="h-4 w-4 rounded border-[#4a4389] bg-[#3E357E] text-[#00aaef] focus:ring-[#00aaef]">
                        <label for="cat-${cat}" class="ml-2 text-sm text-gray-300">${formatString(cat)}</label>
                    </div>`).join('');

                const virtualPlatforms = [...new Set(products.flatMap(p => p.virtualSupport || []))];
                const cloudPlatforms = [...new Set(products.flatMap(p => p.cloudSupport || []))];

                deploymentOptionsContainer.innerHTML = `
                    <div class="flex items-center">
                        <input type="checkbox" id="dep-physical" name="deployment" value="physical" class="h-4 w-4 rounded border-[#4a4389] bg-[#3E357E] text-[#00aaef] focus:ring-[#00aaef]">
                        <label for="dep-physical" class="ml-2 text-sm text-gray-300">Physical</label>
                    </div>
                    <div>
                        <div class="flex items-center">
                            <input type="checkbox" id="dep-virtual" name="deployment" value="virtual" class="h-4 w-4 rounded border-[#4a4389] bg-[#3E357E] text-[#00aaef] focus:ring-[#00aaef]">
                            <label for="dep-virtual" class="ml-2 text-sm text-gray-300">Virtual</label>
                        </div>
                        <div class="pl-6 mt-1 space-y-1" id="virtual-subfilters">
                        ${virtualPlatforms.map(p => `
                            <div class="flex items-center">
                                <input type="checkbox" id="virt-${p}" name="virtualSupport" value="${p}" class="h-4 w-4 rounded border-[#4a4389] bg-[#3E357E] text-[#00aaef] focus:ring-[#00aaef]">
                                <label for="virt-${p}" class="ml-2 text-sm text-gray-400">${formatString(p)}</label>
                            </div>`).join('')}
                        </div>
                    </div>
                    <div>
                        <div class="flex items-center">
                            <input type="checkbox" id="dep-cloud" name="deployment" value="cloud" class="h-4 w-4 rounded border-[#4a4389] bg-[#3E357E] text-[#00aaef] focus:ring-[#00aaef]">
                            <label for="dep-cloud" class="ml-2 text-sm text-gray-300">Cloud</label>
                        </div>
                        <div class="pl-6 mt-1 space-y-1" id="cloud-subfilters">
                        ${cloudPlatforms.map(p => `
                            <div class="flex items-center">
                                <input type="checkbox" id="cloud-${p}" name="cloudSupport" value="${p}" class="h-4 w-4 rounded border-[#4a4389] bg-[#3E357E] text-[#00aaef] focus:ring-[#00aaef]">
                                <label for="cloud-${p}" class="ml-2 text-sm text-gray-400">${formatString(p)}</label>
                            </div>`).join('')}
                        </div>
                    </div>`;

                addFilterListeners();
            }

            function renderProducts() {
                const searchTerm = searchInput.value.toLowerCase();
                const selectedCategories = Array.from(document.querySelectorAll('input[name="category"]:checked')).map(cb => cb.value);
                const showActiveOnly = activeOnlyToggle.checked;
                
                const selectedDeployments = Array.from(document.querySelectorAll('input[name="deployment"]:checked')).map(cb => cb.value);
                const selectedVirtual = Array.from(document.querySelectorAll('input[name="virtualSupport"]:checked')).map(cb => cb.value);
                const selectedCloud = Array.from(document.querySelectorAll('input[name="cloudSupport"]:checked')).map(cb => cb.value);

                const filteredProducts = products.filter(p => {
                    const searchMatch = !searchTerm || JSON.stringify(p).toLowerCase().includes(searchTerm);
                    const categoryMatch = selectedCategories.length === 0 || selectedCategories.includes(p.category);
                    const activeMatch = !showActiveOnly || p.saleStatus === 'active';

                    const deploymentMatch = selectedDeployments.length === 0 || 
                        (selectedDeployments.includes('physical') && p.isPhysical) ||
                        (selectedDeployments.includes('virtual') && p.virtualSupport && p.virtualSupport.length > 0) ||
                        (selectedDeployments.includes('cloud') && p.cloudSupport && p.cloudSupport.length > 0);

                    const virtualMatch = selectedVirtual.length === 0 || (p.virtualSupport && selectedVirtual.every(v => p.virtualSupport.includes(v)));
                    const cloudMatch = selectedCloud.length === 0 || (p.cloudSupport && selectedCloud.every(c => p.cloudSupport.includes(c)));

                    return searchMatch && categoryMatch && activeMatch && deploymentMatch && virtualMatch && cloudMatch;
                });

                resultsContainer.innerHTML = '';
                noResultsMessage.classList.toggle('hidden', filteredProducts.length > 0 || products.length === 0);

                filteredProducts.forEach(product => {
                    const card = document.createElement('div');
                    card.className = 'product-card bg-[#2a236a] rounded-lg shadow-lg p-5 flex flex-col cursor-pointer border border-[#4a4389]';
                    card.dataset.productName = product.name;

                    const statusColor = product.saleStatus === 'active' ? 'bg-[#dae343] text-black' : 'bg-[#f05918] text-white';
                    const supportedModulesText = (product.supportedModules && product.supportedModules.length > 0)
                        ? `Modules: ${product.supportedModules.join(', ')}`
                        : 'Modules: N/A';

                    card.innerHTML = `
                        <div class="flex-grow">
                             <div class="flex justify-between items-start">
                                <h3 class="text-xl font-bold text-white">${product.name}</h3>
                                <span class="text-xs font-semibold px-2 py-1 ${statusColor} rounded-full">${formatString(product.saleStatus)}</span>
                            </div>
                            <p class="text-sm text-gray-400 mb-4">${formatString(product.category)}</p>
                            <div class="grid grid-cols-2 gap-x-4 gap-y-2 text-sm mb-4">
                                <div class="text-gray-400">Throughput: <span class="font-semibold text-gray-200">${product.baseGbps ?? 'N/A'} Gbps</span></div>
                                <div class="text-gray-400">Form Factor: <span class="font-semibold text-gray-200">${product.isPhysical ? 'Physical' : 'Virtual/Cloud'}</span></div>
                            </div>
                        </div>
                        <div class="border-t border-[#4a4389] pt-3 text-xs text-gray-500">
                           ${supportedModulesText}
                        </div>`;
                    resultsContainer.appendChild(card);
                });
                productCountElement.textContent = `${filteredProducts.length} of ${products.length} products shown`;
            }

            function createDetailItem(label, value) {
                if (value === undefined || value === null || (Array.isArray(value) && value.length === 0)) return '';
                let displayValue = (typeof value === 'boolean')
                    ? value ? `<span class="px-2 py-1 text-xs rounded-full bg-[#00aaef] text-white">Yes</span>` : `<span class="px-2 py-1 text-xs rounded-full bg-gray-600 text-gray-200">No</span>`
                    : Array.isArray(value)
                    ? value.map(item => `<span class="inline-block bg-gray-600 rounded-full px-3 py-1 text-sm font-semibold text-gray-200 mr-2 mb-2">${formatString(item)}</span>`).join('')
                    : `<p class="text-gray-200">${value}</p>`;
                return `<div class="py-3 sm:grid sm:grid-cols-3 sm:gap-4"><dt class="text-sm font-medium text-gray-400">${label}</dt><dd class="mt-1 text-sm sm:mt-0 sm:col-span-2">${displayValue}</dd></div>`;
            }

            function renderInterfacesTable(interfaces, title) {
                if (!interfaces || interfaces.length === 0) return '';
                let tableHtml = `
                    <div class="mt-6">
                        <h4 class="text-lg font-semibold mb-2 text-gray-300">${title}</h4>
                        <div class="overflow-x-auto">
                            <table class="min-w-full text-sm text-left text-gray-300">
                                <thead class="text-xs text-gray-400 uppercase bg-[#3E357E]">
                                    <tr>
                                        <th scope="col" class="px-4 py-2">ID</th>
                                        <th scope="col" class="px-4 py-2">Roles</th>
                                        <th scope="col" class="px-4 py-2">Speeds (Gb)</th>
                                        <th scope="col" class="px-4 py-2">Transceiver</th>
                                    </tr>
                                </thead>
                                <tbody>`;
                interfaces.forEach(iface => {
                    tableHtml += `
                        <tr class="border-b border-[#4a4389]">
                            <td class="px-4 py-2">${iface.id}</td>
                            <td class="px-4 py-2">${iface.roles.map(formatString).join(', ')}</td>
                            <td class="px-4 py-2">${iface.supportedSpeedsGb.join(', ')}</td>
                            <td class="px-4 py-2">${iface.transceiverType} ${iface.transceiverIncluded ? '(Included)' : ''}</td>
                        </tr>`;
                });
                tableHtml += '</tbody></table></div></div>';
                return tableHtml;
            }

            function showModal(productName) {
                const product = products.find(p => p.name === productName);
                if (!product) return;

                Object.values(chartInstances).forEach(chart => chart.destroy());
                chartInstances = {};
                modalTitle.textContent = product.name;

                let detailsHtml = '<dl class="divide-y divide-[#4a4389]">';
                detailsHtml += createDetailItem('Category', formatString(product.category));
                detailsHtml += createDetailItem('Sale Status', formatString(product.saleStatus));
                detailsHtml += createDetailItem('Base Throughput', `${product.baseGbps ?? 0} Gbps`);
                detailsHtml += createDetailItem('IDS Throughput', `${product.idsGbps ?? 0} Gbps`);
                detailsHtml += createDetailItem('Supported Modules', product.supportedModules);
                if (product.virtualSupport) detailsHtml += createDetailItem('Virtual Support', product.virtualSupport);
                if (product.cloudSupport) detailsHtml += createDetailItem('Cloud Support', product.cloudSupport);
                detailsHtml += '</dl>';

                let chartsHtml = '';
                const hasPerfChart = (product.baseGbps || product.idsGbps);
                const hasAnalysisChart = (product.standardAnalysis || product.advancedAnalysis);
                if (hasPerfChart || hasAnalysisChart) {
                    chartsHtml += '<div class="grid md:grid-cols-2 gap-6 mt-6 pt-6 border-t border-[#4a4389]">';
                    if (hasPerfChart) chartsHtml += '<div><h4 class="text-lg font-semibold mb-2 text-center text-gray-300">Performance (Gbps)</h4><canvas id="perfChart"></canvas></div>';
                    if (hasAnalysisChart) chartsHtml += '<div><h4 class="text-lg font-semibold mb-2 text-center text-gray-300">Analysis Capacity</h4><canvas id="analysisChart"></canvas></div>';
                    chartsHtml += '</div>';
                }

                let interfacesHtml = '';
                if(product.interfaces) {
                    interfacesHtml += renderInterfacesTable(product.interfaces.management, 'Management Interfaces');
                    interfacesHtml += renderInterfacesTable(product.interfaces.capture, 'Capture Interfaces');
                }

                modalBody.innerHTML = detailsHtml + chartsHtml + interfacesHtml;

                if (hasPerfChart) createPerfChart(product);
                if (hasAnalysisChart) createAnalysisChart(product);

                modal.classList.remove('hidden');
            }

            function createChart(canvasId, label, labels, data, bgColors) {
                 const ctx = document.getElementById(canvasId)?.getContext('2d');
                 if (!ctx) return;
                 chartInstances[canvasId] = new Chart(ctx, { type: 'bar',
                    data: { labels, datasets: [{ label, data, backgroundColor: bgColors, borderWidth: 0 }] },
                    options: { responsive: true, plugins: { legend: { display: false } },
                        scales: { y: { beginAtZero: true, ticks: { color: '#9ca3af' }, grid: { color: '#374151' } },
                                  x: { ticks: { color: '#d1d5db' }, grid: { display: false } } } } });
            }

            function createPerfChart(product) { createChart('perfChart', 'Gbps', ['Base', 'IDS'], [product.baseGbps || 0, product.idsGbps || 0], ['rgba(0, 170, 239, 0.6)', 'rgba(240, 89, 24, 0.6)']); }
            function createAnalysisChart(product) { createChart('analysisChart', 'Capacity', ['Standard', 'Advanced'], [product.standardAnalysis || 0, product.advancedAnalysis || 0], ['rgba(218, 227, 67, 0.6)', 'rgba(236, 0, 137, 0.6)']); }

            function addFilterListeners() {
                searchInput.addEventListener('input', renderProducts);
                categoryOptionsContainer.addEventListener('change', renderProducts);
                activeOnlyToggle.addEventListener('change', renderProducts);
                deploymentOptionsContainer.addEventListener('change', renderProducts);
            }

            function resetFilters() {
                searchInput.value = '';
                document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
                activeOnlyToggle.checked = true;
                renderProducts();
            }

            resultsContainer.addEventListener('click', (e) => e.target.closest('.product-card')?.dataset.productName && showModal(e.target.closest('.product-card').dataset.productName));
            modalCloseButton.addEventListener('click', () => modal.classList.add('hidden'));
            modal.addEventListener('click', (e) => { if (e.target === modal) modal.classList.add('hidden'); });
            resetFiltersButton.addEventListener('click', resetFilters);
            loadDataBtn.addEventListener('click', loadProducts);
            loadProducts();
        });
    </script>
</body>
</html>

